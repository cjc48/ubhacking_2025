from flask import Flask, jsonify, request
app = Flask(__name__)

transcripts_db = []
next_id = 1

# CREATING A TRANSCRIPT
@app.route('/api/transcripts',methods = ['POST'])
def create_transcript():
    global next_id
    data = request.json

    if not data or 'content' not in data or 'mentor_id' not in data:
        return jsonify({'Error': 'Missing fields required'})

    new_transcript = {
        'id': next_id,
        'mentor_id': data['mentor_id'],
        'title': data.get('title','Untitled'),
        'content': data['content']
    }

    transcripts_db.append(new_transcript)
    next_id += 1

    return jsonify(new_transcript),201

# READING ALL TRANSCRIPTS
@app.route('/api/transcripts', methods=['GET'])
def get_all_transcripts():
    return jsonify({'transcripts': transcripts_db})

# READING A SINGLE TRANSCRIPT BY ID
@app.route('/api/transcripts/<int:transcript_id>',methods=['GET'])
def get_transcript(transcript_id):
    transcript = next((t for t in transcripts_db if t['id'] == transcript_id), None)

    if transcript is None:
        return jsonify({'Error': 'Transcript not found'}),404

    data = request.json

    transcript['title'] = data.get('title',transcript['title'])
    transcript['content'] = data.get('content',transcript['content'])
    transcript['mentor_id'] = data.get('mentor_id',transcript['mentor_id'])

    return jsonify(transcript)


# UPDATE A TRANSCRIPT
@app.route('/api/transcripts/<int:transcript_id>',methods = ['PUT'])
def update_transcript(transcript_id):
    transcript = next((t for t in transcripts_db if t['id'] == transcript_id),None)

    if transcript is None:
        return jsonify({'Error': 'Transcript not found'}),404

    data = request.json

    transcript['title'] = data.get('title',transcript['title'])
    transcript['content'] = data.get('content',transcript['content'])
    transcript['mentor_id'] = data.get('mentor_id',transcript['mentor_id'])

    return jsonify(transcript)


# DELETE A TRANSCRIPT BY ID

@app.route('/api/transcripts/<int:transcript_id>',methods=['DELETE'])
def delete_transcript(transcript_id):
    global transcripts_db
    transcript = next((t for t in transcripts_db if t['id'] == transcript_id),None)

    if transcript is None:
        return jsonify({'Error': 'Transcript not found'}),404

    transcripts_db = [t for t in transcripts_db if t['id'] != transcript_id]
    return jsonify({'message': 'Transcript deleted successfully'})

if __name__ == '__main__':
    app.run(debug=True)
